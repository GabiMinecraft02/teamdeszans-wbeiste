<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Admin</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    table { border-collapse: collapse; }
    td, th { border: 1px solid #ccc; padding: 6px; }
    input, select { width: 100%; }
  </style>
</head>
<body>

<h2>Admin â€“ Joueurs</h2>

  <button id="add">â• Ajouter joueur</button>

<table id="table">
  <thead>
    <tr>
      <th>Pseudo</th>
      <th>Jeux</th>
      <th>Dispo</th>
      <th>A.A.</th>
      <th>RÃ´le</th>
      <th>ğŸ—‘ï¸</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const supabase = window.supabase.createClient(
  "https://dxysplkkpvlqzbmyirhx.supabase.co",
  "TA_CLE_ANON_PUBLIQUE"
)

const tbody = document.querySelector("tbody")

function rowHTML(j) {
  return `
    <tr data-id="${j.id}">
      <td><input value="${j.pseudo || ''}" data-col="pseudo"></td>
      <td><input value="${j.jeux || ''}" data-col="jeux"></td>
      <td><input type="checkbox" ${j.disponibilite ? "checked" : ""} data-col="disponibilite"></td>
      <td><input type="checkbox" ${j.aa ? "checked" : ""} data-col="aa"></td>
      <td>
        <select data-col="role">
          <option ${j.role==="Tank"?"selected":""}>Tank</option>
          <option ${j.role==="Heal"?"selected":""}>Heal</option>
          <option ${j.role==="DPS"?"selected":""}>DPS</option>
        </select>
      </td>
      <td>
        <button onclick="removeRow('${j.id}')">ğŸ—‘ï¸</button>
      </td>
    </tr>
  `
}

// Chargement initial
async function load() {
  const { data } = await supabase.from("joueurs").select("*").order("pseudo")
  tbody.innerHTML = data.map(rowHTML).join("")
}
load()

// Update live
tbody.addEventListener("change", async e => {
  const tr = e.target.closest("tr")
  if (!tr) return

  const id = tr.dataset.id
  const col = e.target.dataset.col
  if (!col) return

  const value = e.target.type === "checkbox"
    ? e.target.checked
    : e.target.value

  await supabase.from("joueurs")
    .update({ [col]: value })
    .eq("id", id)
})

// â• Ajouter joueur
document.getElementById("add").onclick = async () => {
  await supabase.from("joueurs").insert({
    pseudo: "",
    jeux: "",
    disponibilite: false,
    aa: false,
    role: "DPS"
  })
}

// ğŸ—‘ï¸ Supprimer joueur
async function removeRow(id) {
  if (!confirm("Supprimer ce joueur ?")) return
  await supabase.from("joueurs").delete().eq("id", id)
}

// Realtime
supabase.channel("realtime-joueurs")
  .on("postgres_changes", {
    event: "*",
    schema: "public",
    table: "joueurs"
  }, load)
  .subscribe()
</script>

</body>
</html>
